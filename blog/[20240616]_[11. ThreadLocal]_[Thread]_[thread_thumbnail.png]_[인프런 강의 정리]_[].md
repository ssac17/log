# ThreadLocal

* 자바에서 스레드는 오직 자신만이 접근해서 읽고 쓸수 있는 로컬변수 저장소를 제공하는데 이를 ThreadLocal 이라고 합니다.
* 각 스레드는 고유한 ThreadLocal 객체를 속성으로 가지고 있으며 ThreadLocal은 스레드 간 격리되어 있습니다.
* 스레드는 ThreadLocal에 저장된 값을 특정한 위ㅊ나 시점에 상관없이 어디에서나 전역변수처럼 사용할수 있습니다. 변수 값은 전달하지 않아도 됩니다.
* 모든 스레드가 공통적으로 처리해야 하는 기능이나 객체를 제어해야 하는 상황에서 스레드마다 다른 값을 적용해야 하는경우 사용합니다.(인증 주체 보관, 트랜잭션 전파, 로그 추적기 등)

</br>

![ThreadLocal](./img/thread/ThreadLocal_1.png)

</br>

**ThreadLocal API**

* void set(T Value)
    * 스레드 로컬에 값을 저장합니다.
* T get()
    * 스레드 로컬에 저장된 값을 가져옵니다.
* void remove()
    * 스레드 로컬에 저장된 값을 가져옵니다.
* withInitial(Supplier<? extends S> supplier)
    * 스레드 로컬을 생성하면서 특정 값으로 초기화합니다.

</br>

#### Code

```java
//생성시 디폴트 값으로 초기화
private final static ThreadLocal<String> threadLocal = ThreadLocal.withInitial(() -> "defaultName");

public static void main(String[] args) {

    threadLocal.set("Hello World"); //Hello World 저장

    String threadLocalValue = threadLocal.get();//값을 반환
    System.out.println(threadLocalValue); //Hello World
    threadLocal.remove(); //제거
}
```

</br>

**Thread & ThreadLocal**

* 스레드는 ThreadLocal에 있는 ThreadLocalMap 객체를 자신의 threadLcoals 속성에 저장합니다.
* 스레드 생성시 threadLocals의 기본값은 null이며 ThreadLocal에 값을 저장할때, ThreadLocalMap이 생성되고 threadLocals와 연결됩니다.
* 스레드가 전역적으로 값을 참조할수 있는 원리는 스레드가 ThreadLocal의 ThreadLocalMap에 접근해서 여기에 저장된 값을 바로 꺼내어 쓸수 있기 때문입니다.

![ThreadLocalMap]()

</br>

출처 - 
 [자바 동시성 프로그래밍 \[리액티브 프로그래밍 Part.1\] | 정수원 - 인프런](https://www.inflearn.com/course/%EC%9E%90%EB%B0%94-%EB%8F%99%EC%8B%9C%EC%84%B1-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D-%EB%A6%AC%EC%95%A1%ED%8B%B0%EB%B8%8C-part1/dashboard)


